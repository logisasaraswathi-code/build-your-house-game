<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Probability Treasure Hunt</title>
<style>
body { font-family: Arial, sans-serif; background: linear-gradient(to top, #87ceeb 0%, #fff 100%); text-align:center; margin:0; padding:0;}
.container { background:white; padding:20px; margin:20px auto; max-width:900px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.3);}
button { padding:10px 20px; margin:5px; font-size:16px; border:none; border-radius:5px; cursor:pointer; background:#007bff; color:white;}
button:hover { background:#0056b3; }
#message { font-weight:bold; font-size:1.2em; min-height:30px; margin-top:10px;}
.progress-bar { width:80%; height:20px; background:#ddd; margin:10px auto; border-radius:10px; overflow:hidden; }
.progress-fill { height:100%; background:gold; width:0%; transition: width 0.5s; }
#inventory div { display:inline-block; margin:5px; padding:5px; border:1px solid #ccc; border-radius:5px; width:80px;}
#housePreview svg { border:1px solid #000; margin-top:10px; }
</style>
</head>
<body>

<div class="container" id="stage1">
<h2>Stage 1: Treasure Hunt</h2>
<p>Coins: <span id="money">0</span></p>
<p>Round: <span id="round">1</span>/5</p>
<div id="chests"></div>
<p id="message"></p>
<div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
</div>

<div class="container" id="stage2" style="display:none;">
<h2>Stage 2: Inventory</h2>
<p>Collected Treasures:</p>
<div id="inventory"></div>
<button onclick="finishStage2()">Build Treasure House</button>
<p id="msg2"></p>
</div>

<div class="container" id="stage3" style="display:none;">
<h2>Stage 3: Treasure House</h2>
<div id="housePreview"></div>
<p id="msg3"></p>
</div>

<script>
let money=0, round=1;
const targetMoney=20000;
let collectedTreasures=[];

const rounds = [
{q:"You see 3 treasure chests on the beach!", rewards:[4000,5000,10000], probs:[0.6,0.3,0.1]},
{q:"A small cave with hidden chests appears!", rewards:[4000,5000,10000], probs:[0.6,0.3,0.1]},
{q:"In the forest, you find mysterious boxes!", rewards:[4000,5000,10000], probs:[0.6,0.3,0.1]},
{q:"Near the river, shiny chests lie around!", rewards:[4000,5000,10000], probs:[0.6,0.3,0.1]},
{q:"Inside the volcano, ancient chests await!", rewards:[4000,5000,10000], probs:[0.6,0.3,0.1]}
];

function showRound(){
  if(round>5){
    if(money>=targetMoney){
      document.getElementById("stage1").style.display="none";
      document.getElementById("stage2").style.display="block";
      displayInventory();
    } else {
      document.getElementById("message").innerText="ðŸ’¸ Not enough coins! Restart Stage 1.";
      money=0; round=1;
      setTimeout(initStage1,2000);
    }
    return;
  }
  const current=rounds[round-1];
  document.getElementById("round").innerText=round;
  const chestsDiv=document.getElementById("chests");
  chestsDiv.innerHTML="";
  for(let i=0;i<3;i++){
    const btn=document.createElement("button");
    btn.innerHTML=`Chest ${i+1} ðŸ’°`;
    btn.onclick=()=>openChest(i);
    chestsDiv.appendChild(btn);
  }
  document.getElementById("message").innerText="Click a chest to collect treasure!";
}

function openChest(i){
  const current=rounds[round-1];
  const rand=Math.random();
  let cumProb=0, reward=0;
  for(let j=0;j<current.probs.length;j++){
    cumProb+=current.probs[j];
    if(rand<=cumProb){ reward=current.rewards[j]; break; }
  }
  money+=reward;
  collectedTreasures.push(reward);
  document.getElementById("money").innerText=money;
  document.getElementById("message").innerText=`âœ¨ You opened chest and earned â‚¹${reward} coins!`;
  document.getElementById("progress").style.width=`${Math.min(100,money/targetMoney*100)}%`;

  // Coin animation
  const msg=document.createElement("div");
  msg.innerText="ðŸ’°";
  msg.style.position="absolute"; msg.style.fontSize="24px";
  msg.style.left=(Math.random()*80+10)+"%"; msg.style.top="50%";
  document.body.appendChild(msg);
  setTimeout(()=>msg.remove(),800);

  round++;
  setTimeout(showRound,1000);
}

function initStage1(){ showRound(); }
initStage1();

// Stage 2: Inventory
function displayInventory(){
  const invDiv=document.getElementById("inventory");
  invDiv.innerHTML="";
  collectedTreasures.forEach((amt,i)=>{
    invDiv.innerHTML+=`<div>Coin<br>â‚¹${amt}</div>`;
  });
}

// Stage 3: Treasure House
function finishStage2(){
  document.getElementById("stage2").style.display="none";
  document.getElementById("stage3").style.display="block";
  const houseDiv=document.getElementById("housePreview");
  let houseHTML=`<svg width="500" height="300">`;
  // House base
  houseHTML+=`<rect x="100" y="100" width="300" height="150" fill="#f4c2c2" stroke="#000"/>`;
  houseHTML+=`<polygon points="90,100 250,20 410,100" fill="#8b0000" stroke="#000"/>`;
  // Coins inside
  let x=120, y=120;
  collectedTreasures.forEach((amt,i)=>{
    houseHTML+=`<circle cx="${x}" cy="${y}" r="10" fill="gold"><animate attributeName="cy" values="${y};${y-20};${y}" dur="1s" repeatCount="1"/></circle>`;
    x+=40; if(x>400){ x=120; y+=30; }
  });
  houseHTML+="</svg>";
  houseDiv.innerHTML=houseHTML;
  document.getElementById("msg3").innerText="ðŸŽ‰ Congratulations! You built your treasure house!";
}
</script>
</body>
</html>
